<?xml version="1.0" encoding="UTF-8"?>
<application xmlns="http://appconfig.aura.nav.no"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://appconfig.aura.nav.no http://maven.adeo.no/xsd/appconfig.xsd ">
    <name>fpsak</name>

    <artifacts>
        <ear groupId="no.nav.foreldrepenger" artifactId="build-ear"/>
        <batch groupId="no.nav.foreldrepenger" artifactId="batch" version="${project.version}" symlink="/var/fpsak/batch"/>
    </artifacts>
    <selftest>
        <path>/fpsak/internal/selftest</path>
        <humanReadablePath>/fpsak/internal/selftest</humanReadablePath>
    </selftest>

    <monitoring>
        <metric path="/fpsak/internal/metrics" interval="60"/>
    </monitoring>

    <exposed-services>
        <exposedSoap name="virksomhet:foreldrepengesak_v1" path="/fpsak/tjenester/sak/finnSak/v1" wsdlGroupId="no.nav.tjenester"
                     wsdlArtifactId="nav-foreldrepengesak-v1-tjenestespesifikasjon"
                     wsdlVersion="${foreldrepenger.tjenstespesifikasjon.versjon}" securityToken="SAML"/>

        <exposedSoap name="virksomhet:behandleForeldrepengesak_v1" path="/fpsak/tjenester/sak/opprettSak/v1" wsdlGroupId="no.nav.tjenester"
                     wsdlArtifactId="nav-behandleForeldrepengesak-v1-tjenestespesifikasjon"
                     wsdlVersion="${behandleForeldrepengesak.tjenstespesifikasjon.versjon}" securityToken="SAML"/>

        <!-- FIXME (u139158): PK-44270 Må versjonere tjenestene og DTO'ene -->
        <exposedRest name="fpsak_vurderFagsystem" path="/fpsak/api/fordel/vurderFagsystem" />
        <exposedRest name="fpsak_saksinformasjon" path="/fpsak/api/fordel/fagsak/informasjon" />
        <exposedRest name="fpsak_opprett_sak" path="/fpsak/api/fordel/fagsak/opprett" />
        <exposedRest name="fpsak_journalpostknyttning" path="/fpsak/api/fordel/fagsak/knyttJournalpost" />
        <exposedRest name="fpsak_mottaJournalpost" path="/fpsak/api/fordel/journalpost" />

        <exposedQueue name="fpsak_mottak_queue" /> <!-- TODO Martin S fjern denne senest 03. april 2018-->

        <exposedQueue name="fpsak_okonomi_oppdrag_mottak" />

        <exposedRest name="fpsakhendelser_v1" path="/fpsak/api/hendelser/" />
        <exposedRest name="fpsak_statusinformasjon" path="/fpsak/api/dokumentforsendelse/status" />
        <exposedRest name="fpsak_feed_vedtak_fp" path="/fpsak/api/vedtak/foreldrepenger" />
        

    </exposed-services>

    <resources>
        <datasource alias="defaultDS" jndi="java:/jdbc/defaultDS" type="ORACLE">
            <flywaySettings baselineVersion="1.0" />
        </datasource>
        <datasource alias="dvhDS" jndi="java:/jdbc/dvhDS" type="ORACLE">
            <flywaySettings baselineVersion="1.0" />
        </datasource>

        <!-- TODO (rune) når vi har to schemas:
        <datasource alias="saksopplysningerDS" jndi="java:/jdbc/saksopplysningerDS" type="ORACLE">
            <flywaySettings baselineVersion="1.0"/>
        </datasource>
        -->
        <!--
            Se https://fasit.adeo.no/wicket/bookmarkable/no.nav.aura.envconfig.gui.resources.ResourceDocumentationPage
            for hvilke system properties som kommer ut av innslagene under:
            (Se også detaljer i http://maven.adeo.no/xsd/appconfig.xsd)
        -->
        <ldap alias="ldap" mapToProperty="ldap"/>
        <webservice alias="Aktoer_v2" mapToProperty="Aktoer_v2"/>
        <webservice alias="virksomhet:Arbeidsfordeling_v1" mapToProperty="Arbeidsfordeling_v1"/>
        <webservice alias="virksomhet:Person_v3" mapToProperty="Person_v3"/>
        <webservice alias="Journal_v3" mapToProperty="Journal_v3"/>
        <webservice alias="InngaaendeJournal_v1" mapToProperty="InngaaendeJournal_v1"/>
        <webservice alias="virksomhet:Arbeidsforhold_v3" mapToProperty="Arbeidsforhold_v3"/>
        <webservice alias="virksomhet:Organisasjon_v4" mapToProperty="Organisasjon_v4"/>
        <webservice alias="virksomhet:BehandleSak_v2" mapToProperty="BehandleSak_v2"/>
        <webservice alias="virksomhet:Sak_v1" mapToProperty="Sak_v1"/>
        <webservice alias="virksomhet:Behandleoppgave_v1" mapToProperty="Behandleoppgave_v1"/>
        <webservice alias="Dokumentproduksjon_v2" mapToProperty="Dokumentproduksjon_v2"/>
        <webservice alias="virksomhet:infotrygdsak_v1" mapToProperty="InfotrygdSak_v1"/>
        <webservice alias="virksomhet:infotrygdBeregningsgrunnlag_v1" mapToProperty="InfotrygdBeregningsgrunnlag_v1"/>
        <webservice alias="virksomhet:MeldekortUtbetalingsgrunnlag_v1" mapToProperty="MeldekortUtbetalingsgrunnlag_v1"/>
        <webservice alias="virksomhet:Inntekt_v3" mapToProperty="Inntekt_v3"/>
        <webservice alias="virksomhet:Medlemskap_v2" mapToProperty="Medlem_v2"/>
        <webservice alias="virksomhet:Oppgave_v3" mapToProperty="Oppgave_v3"/>
        <webservice alias="virksomhet:Kodeverk_v2" mapToProperty="Kodeverk_v2"/>
        <baseUrl alias="securityTokenService" mapToProperty="securityTokenService"/>
        <credential alias="srvengangsstonad" mapToProperty="systembruker"/>
        <rest alias="sigrun" mapToProperty="SigrunRestBeregnetSkatt"/>
        <rest alias="infotrygd.hendelser.api"/>
        <rest alias="abac.pdp.endpoint"/>
        <queueManager alias="mqGateway02" jndi="jms/ConnectionFactory" xaEnabled="false">
            <channel alias="fpsak_channel" />
            <pool minPoolSize="7" maxPoolSize="7" />
            <!-- VL sine køer: -->
            <queue alias="fpsak_mottak_queue" jndi="jms/QueueMottak" /> <!-- TODO Martin S fjern denne senest 03. april 2018-->
            <queue alias="fpsak_okonomi_oppdrag_mottak" jndi="jms/QueueFpsakOkonomiOppdragMotta" />
            <!-- Økonomioppdrag sine køer-->
            <queue alias="fpsak_okonomi_oppdrag_send" jndi="jms/QueueFpsakOkonomiOppdragSend" />
            <!-- Sak og behandling sine køer: -->
            <queue alias="SBEH_SAKSBEHANDLING" jndi="jms/QueueSakOgBehandling"/>
            <queue alias="RAY.AVSTEM_DATA" jndi="jms/QueueFpsakGrensesnittavstemmingSend" targetClient="MQ" />
        </queueManager>
        <baseUrl alias="security-token-service-issuer" mapToProperty="oidc_sts.issuer"/>
        <rest alias="security-token-service-jwks" mapToProperty="oidc_sts.jwks"/>
    </resources>

    <serverOptions>
        <jvmArgs>-Xms1024m -Xmx2048m -Xloggc:fpsak_gc.log -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintGCDateStamps -XX:+UseGCLogFileRotation -XX:GCLogFileSize=50M -XX:NumberOfGCLogFiles=10</jvmArgs>
    </serverOptions>

    <security>
        <logins>
            <!-- Vi benytter aldri "no.nav.aura.loginModule.JWTLoginModule", men moduleClass er required-->
            <openIdConnect moduleClass="no.nav.aura.loginModule.JWTLoginModule">
                <!-- TODO (u139158): PK-41761 Mayu: contextpath burde kanskje vært en maven.prop? -->
                <contextRoot>/fpsak/cb</contextRoot>
            </openIdConnect>
        </logins>
    </security>
    <abacSecurity serviceUserResourceAlias="srvengangsstonad"/>
    <!-- TODO (rune) PK-39187 / Teknisk+Epos+03+-+Logging, Logging til tjenestekall-logg, 3. Konfigurer opp en tjenestelogg
    <logging serviceCalls="true" />
    -->

</application>
